(()=>{var e={487:e=>{e.exports={GameStateService:class{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}}}},t={};function a(s){var r=t[s];if(void 0!==r)return r.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.saveGameEl.addEventListener("click",(e=>this.onSaveGameClick(e))),this.loadGameEl.addEventListener("click",(e=>this.onLoadGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const s=document.createElement("div");s.classList.add("cell","map-tile","map-tile-"+(t=e,a=this.boardSize,0===t?"top-left":t===a-1?"top-right":t===a**2-a?"bottom-left":t===a**2-1?"bottom-right":t>0&&t<a-1?"top":t>a**2-a&&t<a**2-1?"bottom":t>0&&t<a**2-a&&t%a==0?"left":t>a-1&&t<a**2-a&&(t-(a-1))%a==0?"right":"center")),s.addEventListener("mouseenter",(e=>this.onCellEnter(e))),s.addEventListener("mouseleave",(e=>this.onCellLeave(e))),s.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(s)}var t,a;this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const a of e){const e=this.boardEl.children[a.position],s=document.createElement("div");s.classList.add("character",a.character.type);const r=document.createElement("div");r.classList.add("health-level");const i=document.createElement("div");i.classList.add("health-level-indicator","health-level-indicator-"+((t=a.character.health)<15?"critical":t<50?"normal":"high")),i.style.width=`${a.character.health}%`,r.appendChild(i),s.appendChild(r),e.appendChild(s)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach((e=>e.call(null)))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach((e=>e.call(null)))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e,t="yellow"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise((a=>{const s=this.cells[e],r=document.createElement("span");r.textContent=t,r.classList.add("damage"),s.appendChild(r),r.addEventListener("animationend",(()=>{s.removeChild(r),a()}))}))}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}class t{constructor(e,t="generic"){if(this.level=e,this.attack=0,this.defence=0,this.health=50,this.type=t,"Character"===new.target.name)throw new Error("вызов данного конструктора запрещен")}}class s{constructor(e,a){if(!(e instanceof t))throw new Error("character must be instance of Character or its children");if("number"!=typeof a)throw new Error("position must be a number");this.character=e,this.position=a}}class r{constructor(e){this.characters=e}}function i(e,t){for(let a=2;a<=t;a+=1)e.attack=+Math.max(e.attack,e.attack*(80+e.health)/100).toFixed(2),e.defence=+Math.max(e.defence,e.defence*(80+e.health)/100).toFixed(2),e.health=e.health+80<=100?e.health+80:100,e.level+=1;return e}function*l(e,t){let a;if(e[0]?.position){let t;for(let s=0;s<e.length-1;s+=1)switch(e[s].character.type){case"bowman":t=e[e.length-1].classes.find((e=>"Bowman"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1);break;case"daemon":t=e[e.length-1].classes.find((e=>"Daemon"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1);break;case"magician":t=e[e.length-1].classes.find((e=>"Magician"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1);break;case"swordsman":t=e[e.length-1].classes.find((e=>"Swordsman"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1);break;case"undead":t=e[e.length-1].classes.find((e=>"Undead"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1);break;case"vampire":t=e[e.length-1].classes.find((e=>"Vampire"===e.name)),a=new t(1),a.health=e[s].character.health,a=i(a,e[s].character.level+1)}}else{const s=Math.floor(Math.random()*t+1),r=Math.floor(Math.random()*e.length);s>1?(a=new e[r](1),a=i(a,s)):a=new e[r](s)}yield a}function h(e,t,a){const s=[];for(let r=0;r<a;r+=1){const a=l(e,t);s.push(a.next().value)}return new r(s)}class c{constructor(){this.playerBalls=0,this.enemyBalls=0,this.activeTheme=null,this.level=0,this.charactersAndPositions=null}static from(e){return this.queue=e,null}}class n{constructor(t,a,s){this.boardSize=e.boardSize,this.gamePlay=t,this.arrayCharacters=[],this.totalPositionsCherecters=null,this.arrayCharacters=null,this.cellsForSteps=new Set,this.cellsForAttack=new Set,this.attackedСharacter=null,this.callbackToNull=a,this.callbackLevelUp=s}init(e){this.totalPositionsCherecters=e,this.arrayCharacters=e.filter((e=>"enemy"===e.character.gamer))}stepCharacter(){let e=null,t=null;const a=Math.floor(Math.random()*(this.arrayCharacters.length-1+1));(a||0===a)&&(e=this.arrayCharacters[a],this.generateArrayForSteps(e.position,e.character.step,this.gamePlay.boardSize),this.generateArrayForAttack(e.position,e.character.stepAttack,this.gamePlay.boardSize)),this.cellsForAttack.forEach((e=>{this.gamePlay.cells[e].children.length>0&&this.totalPositionsCherecters.forEach((a=>{a.position===e&&"player"===a.character.gamer&&(t=a)}))}));const s=Math.floor(Math.random()*(this.cellsForSteps.size-1+1));if(t){const a=Math.round(Math.max(e.character.attack-t.character.defence,.1*e.character.attack));(async()=>{if(await this.gamePlay.showDamage(t.position,a),t.character.health-=a,t.character.health>0)this.gamePlay.redrawPositions(this.totalPositionsCherecters),c.from({gamer:"player"});else if(t.character.health<=0){this.gamePlay.deselectCell(t.position);const e=this.totalPositionsCherecters.findIndex((e=>e.position===t.position));this.totalPositionsCherecters.splice(e,1),this.gamePlay.redrawPositions(this.totalPositionsCherecters),this.callbackLevelUp(),c.from({gamer:"player"})}})()}else t||0!==this.gamePlay.cells[Array.from(this.cellsForSteps)[s]].children.length?this.stepCharacter():(e.position=Array.from(this.cellsForSteps)[s],this.gamePlay.redrawPositions(this.totalPositionsCherecters),c.from({gamer:"player"}))}generateArrayForSteps(e,t,a){this.cellsForSteps.clear();for(let s=1;s<=t;s+=1){let t=e+a*s;t<64&&(this.cellsForSteps.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForSteps.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForSteps.add(t-s)),t=e-a*s,t>=0&&(this.cellsForSteps.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForSteps.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForSteps.add(t-s)),t=e+s,t<=this.calcFiniteIndexSIde(e,a)[1]&&this.cellsForSteps.add(t),t=e-s,t>=this.calcFiniteIndexSIde(e,a)[0]&&this.cellsForSteps.add(t)}}generateArrayForAttack(e,t,a){this.cellsForAttack.clear();for(let s=1;s<=t;s+=1){let t=e+a*s;t<64&&(this.cellsForAttack.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForAttack.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForAttack.add(t-s)),t=e-a*s,t>=0&&(this.cellsForAttack.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForAttack.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForAttack.add(t-s)),t=e+s,t<=this.calcFiniteIndexSIde(e,a)[1]&&this.cellsForAttack.add(t),t=e-s,t>=this.calcFiniteIndexSIde(e,a)[0]&&this.cellsForAttack.add(t)}}calcFiniteIndexSIde(e,t){let a=e,s=e;for(let e=0;e<t;e+=1)a%t!=0&&(a-=1),(s-(t-1))%t!=0&&(s+=1);return[a,s]}}const o=[class extends t{constructor(e,t){super(e,t),this.gamer="player",this.stepAttack=2,this.step=2,this.attack=25,this.defence=25,this.type="bowman"}},class extends t{constructor(e,t){super(e,t),this.gamer="player",this.stepAttack=1,this.step=4,this.attack=40,this.defence=10,this.type="swordsman"}},class extends t{constructor(e,t){super(e,t),this.gamer="player",this.stepAttack=4,this.step=1,this.attack=10,this.defence=40,this.type="magician"}}],d=[class extends t{constructor(e,t){super(e,t),this.gamer="enemy",this.stepAttack=4,this.step=1,this.attack=10,this.defence=10,this.type="daemon"}},class extends t{constructor(e,t){super(e,t),this.gamer="enemy",this.stepAttack=1,this.step=4,this.attack=40,this.defence=10,this.type="undead"}},class extends t{constructor(e,t){super(e,t),this.gamer="enemy",this.stepAttack=2,this.step=2,this.attack=25,this.defence=25,this.type="vampire"}}];var m=a(487),g=a.n(m);const y=new e;y.bindToDOM(document.querySelector("#game-container"));const p=new(g())(localStorage),u=new class{constructor(e,t){this.gamePlay=e,this.computerLogic=null,this.gameState=null,this.stateService=t,this.counterLevel=0,this.lastIndex=null,this.placesForPlayer=null,this.placesForEnemy=null,this.cellsForSteps=new Set,this.cellsForAttack=new Set,this.activeCharacter=null,this.targetCharacter=null,this.gameStop=!1}init(){this.gamePlay.drawUi("prairie"),this.computerLogic=new n(this.gamePlay,this.toNull.bind(this),this.levelUp.bind(this)),this.gameState=new c,this.gameState.activeTheme="prairie",this.generateTeamsAndPositions(),this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.computerLogic.init(this.arrayPositionedCharacter),c.from({gamer:"player"}),this.addListeners(),console.log(this.gamePlay.boardSize)}addListeners(){this.gamePlay.addNewGameListener(this.newGame.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addSaveGameListener(this.saveGame.bind(this)),this.gamePlay.addLoadGameListener(this.loadGame.bind(this))}onCellClick(t){if(this.gameStop)return this.gamePlay.setCursor("auto"),void this.gamePlay.deselectCell(t);if(this.gamePlay.cells[t].children.length>0){const e=this.arrayPositionedCharacter.find((e=>e.position===t));this.validateCharacter(e.character)&&(this.activeCharacter=e)}if(this.gamePlay.cells[t].children.length>0){const e=this.arrayPositionedCharacter.find((e=>e.position===t));"enemy"===e.character.gamer?this.targetCharacter=e:this.targetCharacter=null}if(this.targetCharacter||this.activeCharacter||0!==this.gamePlay.cells[t].children.length){if(this.targetCharacter&&!this.activeCharacter&&this.gamePlay.cells[t].children.length>0&&e.showError("Вы не можете управлять персонажем противника"),(this.lastIndex||0===this.lastIndex)&&[...this.cellsForSteps].includes(t)&&0===this.gamePlay.cells[t].children.length&&"player"===c.queue.gamer?(this.gamePlay.deselectCell(this.lastIndex),this.gamePlay.selectCell(t),this.activeCharacter.position=t,this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.cellsForSteps.clear(),this.cellsForAttack.clear(),this.generateArrayForSteps(t,this.activeCharacter.character.step,this.gamePlay.boardSize),this.generateArrayForAttack(t,this.activeCharacter.character.stepAttack,this.gamePlay.boardSize),c.from({gamer:"enemy"}),this.computerLogic.stepCharacter(),this.levelUp()):!this.lastIndex&&0!==this.lastIndex||0!==this.gamePlay.cells[t].children.length||[...this.cellsForSteps].includes(t)||e.showError("Вы не можете идти сюда, это слишком далеко для одного хода"),(this.lastIndex||0===this.lastIndex)&&[...this.cellsForAttack].includes(t)&&this.targetCharacter&&"player"===c.queue.gamer){const e=Math.round(Math.max(this.activeCharacter.character.attack-this.targetCharacter.character.defence,.1*this.activeCharacter.character.attack));(async()=>{if(await this.gamePlay.showDamage(t,e),this.targetCharacter.character.health-=e,this.targetCharacter.character.health>0)this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.targetCharacter=null,c.from({gamer:"enemy"}),this.computerLogic.stepCharacter();else if(this.targetCharacter.character.health<=0){const e=this.arrayPositionedCharacter.findIndex((e=>e.position===this.targetCharacter.position));this.arrayPositionedCharacter.splice(e,1),this.gamePlay.redrawPositions(this.arrayPositionedCharacter);const t=this.computerLogic.arrayCharacters.findIndex((e=>e.position===this.targetCharacter.position));(t||0===t)&&this.computerLogic.arrayCharacters.splice(t,1),this.targetCharacter=null,c.from({gamer:"enemy"}),this.computerLogic.arrayCharacters.length>0&&this.computerLogic.stepCharacter(),this.levelUp()}})()}!this.lastIndex&&0!==this.lastIndex||this.targetCharacter?this.lastIndex||this.targetCharacter||(this.gamePlay.selectCell(t),this.lastIndex=t,this.generateArrayForSteps(t,this.activeCharacter.character.step,this.gamePlay.boardSize),this.generateArrayForAttack(t,this.activeCharacter.character.stepAttack,this.gamePlay.boardSize)):(this.gamePlay.deselectCell(this.lastIndex),this.gamePlay.selectCell(t),this.lastIndex=t,this.generateArrayForSteps(t,this.activeCharacter.character.step,this.gamePlay.boardSize),this.generateArrayForAttack(t,this.activeCharacter.character.stepAttack,this.gamePlay.boardSize)),this.activeCharacter&&this.targetCharacter&&![...this.cellsForAttack].includes(t)&&(e.showError("Враг слишком далеко"),this.targetCharacter=null)}}onCellEnter(e){const t=this.arrayPositionedCharacter.find((t=>t.position===e));if(this.gameStop)return this.gamePlay.setCursor("auto"),void this.gamePlay.deselectCell(e);if(this.gamePlay.cells[e].children.length>0){const a=this.generateMessageForTitle(t.character);this.gamePlay.showCellTooltip(a,e),this.gamePlay.setCursor("pointer")}[...this.cellsForSteps].includes(e)||0!==this.gamePlay.cells[e].children.length||!this.lastIndex&&0!==this.lastIndex?[...this.cellsForSteps].includes(e)&&0===this.gamePlay.cells[e].children.length&&(this.lastIndex||0===this.lastIndex)&&(this.gamePlay.selectCell(e,"green"),this.gamePlay.setCursor("pointer"),this.lastIndexEnter=e):this.gamePlay.setCursor("not-allowed"),(this.lastIndex||0===this.lastIndex)&&![...this.cellsForAttack].includes(e)&&this.lastIndex!==e&&this.gamePlay.cells[e].children.length>0&&"player"!==t.character.gamer?this.gamePlay.setCursor("not-allowed"):[...this.cellsForAttack].includes(e)&&this.gamePlay.cells[e].children.length>0&&"player"!==t.character.gamer&&(this.gamePlay.selectCell(e,"red"),this.gamePlay.setCursor("crosshair"),this.lastIndexEnter=e)}onCellLeave(e){if(this.gameStop)return this.gamePlay.setCursor("auto"),void this.gamePlay.deselectCell(e);const t=this.arrayPositionedCharacter.find((t=>t.position===e));this.gamePlay.setCursor("auto"),this.gamePlay.cells[e].children.length>0&&this.gamePlay.hideCellTooltip(e),!this.lastIndexEnter&&0!==this.lastIndexEnter||0!==this.gamePlay.cells[e].children.length||this.gamePlay.deselectCell(e),t&&"enemy"===t.character.gamer&&this.gamePlay.deselectCell(e)}newGame(){this.toNull(),this.gameStop=!1,this.counterLevel=0,this.gamePlay.drawUi("prairie"),this.generateTeamsAndPositions(),this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.computerLogic.init(this.arrayPositionedCharacter),c.from({gamer:"player"})}levelUp(){const e=this.arrayPositionedCharacter.filter((e=>"player"===e.character.gamer)),t=this.arrayPositionedCharacter.filter((e=>"enemy"===e.character.gamer)),a=["prairie","desert","arctic","mountain"];if((0===t.length||0===e.length)&&3===this.counterLevel)return this.gameStop=!0,void this.gamePlay.cells.forEach((e=>{e.matches(".selected-yellow")&&e.classList.remove("selected-yellow"),0===t.length?this.gameState.playerBalls+=1:this.enemyBalls+=1}));if(0===t.length&&e.length>0){this.gameState.playerBalls+=1,this.toNull(),this.counterLevel+=1;const t=Math.floor(Math.random()*(this.placesForPlayer.length-e.length+1)+e.length);console.log(t);const s=t-e.length;this.teamPlayer=null,e.push({classes:o}),s>0?(this.teamPlayer=h(o,this.counterLevel,s),h(e,this.counterLevel,e.length-1).characters.forEach((e=>this.teamPlayer.characters.push(e)))):this.teamPlayer=h(e,this.counterLevel,e.length-1),this.teamEnemy=null,this.teamEnemy=h(d,this.counterLevel+1,t);const r=this.placementPositionGenerator(this.placesForPlayer,t),i=this.placementPositionGenerator(this.placesForEnemy,t);this.arrayPositionedCharacter=null,this.arrayPositionedCharacter=this.genArrayPositionedCharacter(this.teamPlayer,this.teamEnemy,r,i),this.computerLogic.cellsForSteps.clear(),this.computerLogic.cellsForAttack.clear(),this.attackedСharacter=null,this.computerLogic.init(this.arrayPositionedCharacter),this.gamePlay.drawUi(a[this.counterLevel]),this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.gameState.activeTheme=a[this.counterLevel],c.from({gamer:"player"})}else if(t.length>0&&0===e.length){this.gameState.enemyBalls+=1,this.counterLevel+=1;const s=Math.floor(Math.random()*(this.placesForPlayer.length-e.length+1)+e.length),r=s-t.length;this.teamEnemy=null,t.push({classes:d}),r>0?(this.teamEnemy=h(d,this.counterLevel,r),h(t,this.counterLevel,t.length-1).characters.forEach((e=>this.teamEnemy.characters.push(e)))):this.teamEnemy=h(t,this.counterLevel,t.length-1),this.teamPlayer=null,this.teamPlayer=h(o,this.counterLevel+1,s);const i=this.placementPositionGenerator(this.placesForPlayer,s),l=this.placementPositionGenerator(this.placesForEnemy,s);this.arrayPositionedCharacter=null,this.arrayPositionedCharacter=this.genArrayPositionedCharacter(this.teamPlayer,this.teamEnemy,i,l),this.computerLogic.cellsForSteps.clear(),this.computerLogic.cellsForAttack.clear(),this.attackedСharacter=null,this.computerLogic.init(this.arrayPositionedCharacter),this.gamePlay.drawUi(a[this.counterLevel]),this.gameState.activeTheme=a[this.counterLevel],this.gamePlay.redrawPositions(this.arrayPositionedCharacter),c.from({gamer:"player"})}}toNull(){this.lastIndex=null,this.cellsForSteps.clear(),this.cellsForAttack.clear(),this.activeCharacter=null,this.targetCharacter=null}generateArrayForSteps(e,t,a){this.cellsForSteps.clear();for(let s=1;s<=t;s+=1){let t=e+a*s;t<64&&(this.cellsForSteps.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForSteps.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForSteps.add(t-s)),t=e-a*s,t>=0&&(this.cellsForSteps.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForSteps.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForSteps.add(t-s)),t=e+s,t<=this.calcFiniteIndexSIde(e,a)[1]&&this.cellsForSteps.add(t),t=e-s,t>=this.calcFiniteIndexSIde(e,a)[0]&&this.cellsForSteps.add(t)}}generateArrayForAttack(e,t,a){this.cellsForAttack.clear();for(let s=1;s<=t;s+=1){let t=e+a*s;t<64&&(this.cellsForAttack.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForAttack.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForAttack.add(t-s)),t=e-a*s,t>=0&&(this.cellsForAttack.add(t),t+s<=this.calcFiniteIndexSIde(t,a)[1]&&this.cellsForAttack.add(t+s),t-s>=this.calcFiniteIndexSIde(t,a)[0]&&this.cellsForAttack.add(t-s)),t=e+s,t<=this.calcFiniteIndexSIde(e,a)[1]&&this.cellsForAttack.add(t),t=e-s,t>=this.calcFiniteIndexSIde(e,a)[0]&&this.cellsForAttack.add(t)}}calcFiniteIndexSIde(e,t){let a=e,s=e;for(let e=0;e<t;e+=1)a%t!=0&&(a-=1),(s-(t-1))%t!=0&&(s+=1);return[a,s]}validateCharacter(e){if("player"===c.queue.gamer)return o.some((t=>(new t).type===e.type))}genArrayPositionedCharacter(e,t,a,r){const i=[];for(let t=0;t<=a.length-1;t+=1)i.push(new s(e.characters[t],a[t]));for(let e=0;e<=r.length-1;e+=1)i.push(new s(t.characters[e],r[e]));return i}placementPositionGenerator(e,t){const a=new Set;for(let s=0;a.size<=t-1;s+=1){const t=Math.floor(Math.random()*e.length);a.add(e[t])}return Array.from(a)}generatePlaces(e,t){const a=[];if("player"===e){for(let e=0;e<=t*(t-1);e+=t)a.push(e),a.push(e+1);return a}for(let e=0;e<=t*(t-1);e+=t)a.push(e+(t-1)),a.push(e+(t-2));return a}generateMessageForTitle(e){return`🎖${e.level} ⚔${e.attack} 🛡${e.defence} ❤${e.health}`}generateTeamsAndPositions(){this.placesForPlayer=this.generatePlaces("player",this.gamePlay.boardSize),this.placesForEnemy=this.generatePlaces("enemy",this.gamePlay.boardSize);const e=Math.floor(Math.random()*this.placesForPlayer.length+1);this.teamPlayer=h(o,1,e),this.teamEnemy=h(d,1,e);const t=this.placementPositionGenerator(this.placesForPlayer,e),a=this.placementPositionGenerator(this.placesForEnemy,e);this.arrayPositionedCharacter=this.genArrayPositionedCharacter(this.teamPlayer,this.teamEnemy,t,a)}saveGame(){this.gameState.charactersAndPositions=this.arrayPositionedCharacter,this.gameState.level=this.counterLevel,this.stateService.save(this.gameState)}loadGame(){this.gameStop=!1;const e=this.stateService.load();this.arrayPositionedCharacter=e.charactersAndPositions,this.counterLevel=e.level,this.gamePlay.playerBalls=e.playerBalls,this.gamePlay.enemyBalls=e.enemyBalls,this.gamePlay.drawUi(e.activeTheme),this.gamePlay.redrawPositions(this.arrayPositionedCharacter),this.computerLogic.init(this.arrayPositionedCharacter),c.from({gamer:"player"})}}(y,p);u.init()})()})();